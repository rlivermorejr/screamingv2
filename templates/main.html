{% extends "index.html" %}
{% block content %}
<div class='container mt-4 text-center'>
  <!-- the post form -->
  {% if request.user.is_authenticated %}
  <div class="form-group">
    <form method='POST' action="" class="form-horizontal">
      {% csrf_token %}
      <label>Scream something in 140 or less:</label>
      <br>
      {{ post_tweet }}
      <input class="btn btn-primary" type='submit' value='Submit'>
    </form>
  </div>
  {% endif %}
</div>
</br>

<!-- list of all posts
{% for foo in tweets %}
{% autoescape off %}
<div class="container mt-5 mb-5">
  <div class="d-flex justify-content-center row">
    <div class="d-flex flex-column col-md-8">
      <div class="d-flex flex-row align-items-center text-left comment-top p-2 bg-white border-bottom px-4">
        <div class="profile-image"><img class="rounded-circle" src={{ foo.posted_by.profile_image }} width="70"></div>
        <a href='/profile/{{ foo.posted_by.id }}'>
          {{ foo.posted_by }}
        </a>
        screams:
        </p>
        <div class="d-flex flex-column-reverse flex-grow-0 align-items-center votings ml-1"><i
            class="fa fa-sort-up fa-2x hit-voting"></i><span>{{ foo.likes.count }}</span><i
            class="fa fa-sort-down fa-2x hit-voting"></i></div>
        <div class="d-flex flex-column ml-3">
          <div class="d-flex flex-row post-title text-uppercase">
            {{ foo.content }}!!!
          </div>
          <span class="mr-2 comments">{{ foo.comments.all.count }} comments&nbsp;</span><span
            class="mr-2 dot"></span><span>{{ foo.creation_time }}</span>
        </div>
      </div>
    </div>

    <br>
    {% if request.user.is_authenticated %}
    <div class='buttons'>
      <a href='/like/{{ foo.id }}'>
        <button class="btn-xs">Like: {{ foo.likes.count }}</button>
      </a> |
      <a href="/dislike/{{ foo.id }}">
        <button class="btn-xs">Dislike: {{ foo.dislikes.count }}</button>
      </a>
    </div>
    <hr>
    {% endif %}
    <details>
      <summary>Comments {{ foo.comments.all.count }}</summary>
      <form action="/comment/{{ foo.id }}/" enctype="multipart/form-data" method="POST" class="form-horizontal">
        {% csrf_token %}
        {{ comment_form }}
        <input class="btn btn-primary" type='submit' value='Submit'>
      </form>
      {% for comments in foo.comments.all %}
      <div class="shadow p-4 mb-4 bg-white w-100">
        <a href="/profile/{{ comments.comment_by.id }}"><img src="{{ comments.comment_by.profile_image.url }}"
            width="50" height="50" class="rounded-circle"></a>
        <p><a href="/profile/{{ comments.comment_by.id }}">{{ comments.comment_by }}</a> Replied:</p>
        <p>{{ comments.content }}</p>
        <p>{{ comments.created_at }}</p>

        <a href="/like/{{ comments.id }}/comment">
          <button class="btn-xs">
            Upvote | {{ comments.likes.count}}
          </button>
        </a>

        {% if request.user == comments.author %}
        <a href="/delete_comments/{{ comments.id }}/"><button>delete</button></a>
        {% endif %}
      </div>

      {% endfor %}
    </details>
  </div>
  {% endautoescape %}
  {% endfor %}
</div>
</div>
</div>
</div> -->
{% for post in tweets %}
{% autoescape off %}
<div class="container mt-5 mb-5">
  <div class="d-flex justify-content-center row">
    <div class="d-flex flex-column col-md-8">
      <div class="d-flex flex-row align-items-center text-left comment-top p-2 bg-white border-bottom px-4">
        <div class="profile-image">
          <img class="rounded-circle" src={{ post.posted_by.profile_image }} width="62" height="60">
        </div>
        <div class="d-flex flex-column flex-grow-0 align-items-center votings ml-4 mr-1 font-small">
          {% if request.user in post.likes.all %}
          <a class="fa fa-thumbs-up fa-2x hit-voting" href='/like/{{ post.id }}'></a>
          <span>
            {{ post.likes.count }}
          </span>
          {% else %}
          <a class="fa fa-thumbs-o-up fa-2x hit-voting" href='/like/{{ post.id }}'></a>
          <span>
            {{ post.likes.count }}
          </span>
          {% endif %}
          {% if request.user in post.dislikes.all %}
          <a class="fa fa-thumbs-down fa-2x hit-voting" href='/dislike/{{ post.id }}'></a>
          <span>
            {{ post.dislikes.count }}
          </span>
          {% else %}
          <a class="fa fa-thumbs-o-down fa-2x hit-voting" href='/dislike/{{ post.id }}'></a>
          <span>
            {{ post.dislikes.count }}
          </span>
          {% endif %}
        </div>
        <div class="d-flex flex-column ml-5">
          <div class="d-flex flex-row post-title font-title">
            <span>
              <a href="/profile/{{ post.posted_by.id }}">
                {{ post.posted_by }}</a>&nbsp;screams:
            </span>
          </div>
          <div class="d-flex flex-row mt-1 mb-3 font-regular">
            <div class="post">{{ post.content }}!!!</div>
          </div>
          <div class="d-flex flex-row align-items-center align-content-center post-title font-small">
            <!-- <span class="bdge mr-2">
              (link)
            </span> -->
            <span class="mr-2 comments">
              {{ post.comments.count }}&nbsp;comments
            </span>
            <span class="mr-2 dot"></span>
            <span>
              {{ post.creation_time }}
            </span>
          </div>
        </div>
      </div>
      <!-- <details>
        <summary>Comments</summary> -->
      <div class="comment-bottom bg-white p-2 px-4">
        <div class="d-flex flex-row add-comment-section mt-4 mb-4">
          {% for comments in post.comments.all %}
          <a href="/profile/{{ comments.comment_by.id }}/"></a>
          <img class="img-fluid img-responsive rounded-circle mr-2" src="{{ request.user.profile_image.url }}"
            width="33">
          <form action="/comment/{{ foo.id }}/" enctype="multipart/form-data" method="POST" class="form-horizontal">
            {% csrf_token %}
            {{ comment_form }}
            <input class="btn btn-primary mb-2" type='submit' value='Submit'>
          </form>
        </div>

        <div class="commented-section">
          <div class="d-flex flex-row align-items-center">
            <h5 class="mr-2">
              <a href="/profile/{{ comments.comment_by.id }}/">
                {{ comments.comment_by }}
              </a>
            </h5>
            <span class="dot mb-2"></span>
            <span class="ml-2 font-small">
              {{ comments.created_at }}
            </span>
          </div>
          <div class="comment-text post">
            <span>
              {{ comments.content }}!!!
            </span>
          </div>
          <div class="reply-section font-small">
            <div class="d-flex flex-row align-items-center voting-icons">
              <a class="fa fa-sort-up fa-2x mt-3 hit-voting" href="/like/{{ comments.id }}/comment/"></a>
              <span class="ml-1 mr-2">
                {{ comments.likes.count }}
              </span>
              <a class="fa fa-sort-down fa-2x mb-3 hit-voting" href="/dislike/{{ comments.id }}/comment/"></a>
              <span class="ml-1 mr-2">
                {{ comments.dislikes.count }}
              </span>
              <span class=""></span>
              {% if comments.comment_by == request.user %}
              <a href="/delete_comments/{{ comments.id }}/">
                <button>delete</button></a>
              {% endif %}
              </span>
            </div>
            <!-- <span class="dot ml-2"></span> -->
            <!-- <h6 class="ml-2 mt-1">Reply</h6> -->
          </div>
        </div>
        {% endfor %}
      </div>
    </div>
    </details>
  </div>
</div>
</div>
{% endautoescape %}
{% endfor %}
{% endblock content %}